# PUT /users/{userId} - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°API

## Overview
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŸºæœ¬æƒ…å ±ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹APIã€‚
ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ã€‚

## Endpoint
```
PUT /api/v1/users/{userId}
```

## Access Control
- **èªè¨¼**: ğŸ” å¿…é ˆï¼ˆJWT Cookieèªè¨¼ï¼‰
- **æ¨©é™**: ğŸ‘¤ æœ¬äººã®ã¿ï¼ˆè‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã¿æ›´æ–°å¯èƒ½ï¼‰

## Path Parameters

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|------|------|
| `userId` | string (UUID) | âœ… | æ›´æ–°å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

## Request Body

ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã€‚æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°ã•ã‚Œã‚‹ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰ã€‚

```json
{
  "username": "yamada_taro",
  "avatarUrl": "https://example.com/avatar.png",
  "displayName": "å±±ç”°å¤ªéƒ",
  "tagline": "æ¯æœ5æ™‚èµ·ãã‚’ç›®æŒ‡ã™ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
  "bio": "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦5å¹´ç›®ã€‚æœæ´»ã§èª­æ›¸ã¨æŠ€è¡“å­¦ç¿’ã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚",
  "skills": ["TypeScript", "React", "Node.js", "AWS"],
  "interests": ["èª­æ›¸", "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°", "ã‚³ãƒ¼ãƒ’ãƒ¼"],
  "vision": "æŠ€è¡“ã§ç¤¾ä¼šã«è²¢çŒ®ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚‹",
  "isVisionPublic": true,
  "socialLinks": [
    { "platform": "twitter", "url": "https://twitter.com/yamada_taro" },
    { "platform": "github", "url": "https://github.com/yamada-taro" }
  ]
}
```

### Request Fields

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | åˆ¶ç´„ | èª¬æ˜ |
|-----------|-----|------|------|------|
| `username` | string | âŒ | æœ€å¤§100æ–‡å­—ã€è‹±æ•°å­—ã¨_ã®ã¿ | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| `avatarUrl` | string \| null | âŒ | æœ‰åŠ¹ãªURL | ã‚¢ãƒã‚¿ãƒ¼ç”»åƒURL |
| `displayName` | string | âŒ | æœ€å¤§100æ–‡å­— | è¡¨ç¤ºå |
| `tagline` | string \| null | âŒ | æœ€å¤§150æ–‡å­— | ä¸€è¨€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« |
| `bio` | string \| null | âŒ | æœ€å¤§1000æ–‡å­— | è‡ªå·±ç´¹ä»‹æ–‡ |
| `skills` | string[] | âŒ | å„è¦ç´ æœ€å¤§50æ–‡å­—ã€æœ€å¤§20å€‹ | ã‚¹ã‚­ãƒ«ä¸€è¦§ |
| `interests` | string[] | âŒ | å„è¦ç´ æœ€å¤§50æ–‡å­—ã€æœ€å¤§20å€‹ | èˆˆå‘³ãƒ»é–¢å¿ƒä¸€è¦§ |
| `vision` | string \| null | âŒ | æœ€å¤§500æ–‡å­— | ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»å°†æ¥ã®ç›®æ¨™ |
| `isVisionPublic` | boolean | âŒ | - | ãƒ“ã‚¸ãƒ§ãƒ³ã®å…¬é–‹è¨­å®š |
| `socialLinks` | SocialLinkInput[] | âŒ | æœ€å¤§10å€‹ | SNSãƒªãƒ³ã‚¯ä¸€è¦§ï¼ˆå…¨ç½®æ›ï¼‰ |

#### SocialLinkInput Object

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | åˆ¶ç´„ | èª¬æ˜ |
|-----------|-----|------|------|------|
| `platform` | string | âœ… | ä¸‹è¨˜ã®å€¤ã®ã¿ | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç¨®åˆ¥ |
| `url` | string | âœ… | æœ‰åŠ¹ãªURL | ãƒªãƒ³ã‚¯URL |
| `title` | string \| null | âŒ | æœ€å¤§100æ–‡å­— | ãƒªãƒ³ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ« |

**platform ã®å€¤:** `twitter`, `instagram`, `github`, `linkedin`, `website`, `blog`, `note`

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹

#### è¡¨ç¤ºåã¨ã‚¿ã‚°ãƒ©ã‚¤ãƒ³ã®ã¿æ›´æ–°
```json
{
  "displayName": "å±±ç”° å¤ªéƒ",
  "tagline": "æ—©èµ·ãã¯ä¸‰æ–‡ã®å¾³"
}
```

#### ã‚¹ã‚­ãƒ«ã¨èˆˆå‘³ã®ã¿æ›´æ–°
```json
{
  "skills": ["TypeScript", "React", "Next.js"],
  "interests": ["èª­æ›¸", "æœæ´»", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°"]
}
```

#### ãƒ“ã‚¸ãƒ§ãƒ³ã‚’éå…¬é–‹ã«å¤‰æ›´
```json
{
  "isVisionPublic": false
}
```

#### SNSãƒªãƒ³ã‚¯ã‚’æ›´æ–°
```json
{
  "socialLinks": [
    { "platform": "twitter", "url": "https://twitter.com/new_handle" },
    { "platform": "github", "url": "https://github.com/yamada-taro" },
    { "platform": "note", "url": "https://note.com/yamada" }
  ]
}
```
â€» æ—¢å­˜ã®ãƒªãƒ³ã‚¯ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã€æŒ‡å®šã—ãŸãƒªãƒ³ã‚¯ã§ç½®æ›ã•ã‚Œã‚‹

## Response

### Success Response (200 OK)

æ›´æ–°å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™ã€‚

```json
{
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "username": "yamada_taro",
      "avatarUrl": "https://example.com/avatar.png",
      "displayName": "å±±ç”°å¤ªéƒ",
      "tagline": "æ¯æœ5æ™‚èµ·ãã‚’ç›®æŒ‡ã™ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
      "bio": "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦5å¹´ç›®ã€‚æœæ´»ã§èª­æ›¸ã¨æŠ€è¡“å­¦ç¿’ã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚",
      "skills": ["TypeScript", "React", "Node.js", "AWS"],
      "interests": ["èª­æ›¸", "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°", "ã‚³ãƒ¼ãƒ’ãƒ¼"],
      "vision": "æŠ€è¡“ã§ç¤¾ä¼šã«è²¢çŒ®ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚‹",
      "isVisionPublic": true,
      "socialLinks": [
        {
          "id": "link-001",
          "platform": "twitter",
          "url": "https://twitter.com/yamada_taro",
          "title": null
        }
      ],
      "totalAttendanceDays": 156,
      "currentStreakDays": 23,
      "maxStreakDays": 45,
      "currentTitleLevel": 6,
      "joinedAt": "2024-01-15T00:00:00Z"
    }
  },
  "message": "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ",
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

### Error Responses

#### 401 Unauthorized
```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "èªè¨¼ãŒå¿…è¦ã§ã™"
  },
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

#### 403 Forbidden
```json
{
  "error": {
    "code": "FORBIDDEN",
    "message": "ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"
  },
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

#### 404 Not Found
```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "æŒ‡å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
  },
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

#### 400 Bad Request
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™",
    "details": {
      "username": "è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™",
      "tagline": "150æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„",
      "skills": "ã‚¹ã‚­ãƒ«ã¯20å€‹ã¾ã§ç™»éŒ²ã§ãã¾ã™"
    }
  },
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

#### 409 Conflict
```json
{
  "error": {
    "code": "CONFLICT",
    "message": "ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™"
  },
  "timestamp": "2025-01-21T10:00:00+00:00"
}
```

## Data Sources

ã“ã®APIã¯ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ï¼š

| ãƒ†ãƒ¼ãƒ–ãƒ« | æ›´æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|---------|---------------|
| `users` | username, avatar_url |
| `user_metadata` | display_name, tagline, bio, skills, interests |
| `user_visions` | vision, is_public |
| `user_social_links` | platform, url, titleï¼ˆå…¨ç½®æ›ï¼‰ |

## Validation Rules

### username
- è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ `_` ã®ã¿è¨±å¯
- æœ€å¤§100æ–‡å­—
- ä¸€æ„æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨é‡è¤‡ä¸å¯ï¼‰
- ç©ºæ–‡å­—ä¸å¯ï¼ˆnullã¯è¨±å¯ã—ãªã„ï¼‰

### avatarUrl
- æœ‰åŠ¹ãªURLå½¢å¼
- nullã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¢ãƒã‚¿ãƒ¼ã‚’å‰Šé™¤

### displayName
- æœ€å¤§100æ–‡å­—
- ç©ºæ–‡å­—ã®å ´åˆã¯usernameã‚’ä½¿ç”¨

### tagline
- æœ€å¤§150æ–‡å­—
- nullã§å‰Šé™¤

### bio
- æœ€å¤§1000æ–‡å­—
- nullã§å‰Šé™¤

### skills / interests
- é…åˆ—ã®å„è¦ç´ ã¯æœ€å¤§50æ–‡å­—
- é…åˆ—ã®æœ€å¤§è¦ç´ æ•°ã¯20
- ç©ºé…åˆ— `[]` ã‚’æŒ‡å®šã™ã‚‹ã¨å…¨å‰Šé™¤
- é‡è¤‡è¦ç´ ã¯è‡ªå‹•çš„ã«é™¤å»

### vision
- æœ€å¤§500æ–‡å­—
- nullã§å‰Šé™¤

### isVisionPublic
- booleanå€¤ã®ã¿

### socialLinks
- é…åˆ—ã®æœ€å¤§è¦ç´ æ•°ã¯10
- æŒ‡å®šã—ãŸå ´åˆã€æ—¢å­˜ã®ãƒªãƒ³ã‚¯ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã€æ–°ã—ã„ãƒªãƒ³ã‚¯ã§**å…¨ç½®æ›**ã•ã‚Œã‚‹
- ç©ºé…åˆ— `[]` ã‚’æŒ‡å®šã™ã‚‹ã¨å…¨ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’çœç•¥ã—ãŸå ´åˆã¯æ—¢å­˜ã®ãƒªãƒ³ã‚¯ã‚’ç¶­æŒï¼ˆæ›´æ–°ã—ãªã„ï¼‰
- åŒä¸€platformã®é‡è¤‡ã¯è¨±å¯ï¼ˆè¤‡æ•°ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆç­‰ï¼‰

## Notes

- éƒ¨åˆ†æ›´æ–°ï¼ˆPATCHçš„ãªå‹•ä½œï¼‰: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°
- `user_metadata` / `user_visions` ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯è‡ªå‹•ä½œæˆï¼ˆUPSERTï¼‰
- `socialLinks` ã¯å…¨ç½®æ›æ–¹å¼ï¼ˆå·®åˆ†æ›´æ–°ã§ã¯ãªã„ï¼‰
- å‚åŠ çµ±è¨ˆãƒ»ç§°å·ã¯èª­ã¿å–ã‚Šå°‚ç”¨ï¼ˆã“ã®APIã§ã¯æ›´æ–°ä¸å¯ï¼‰

## Related Endpoints

- `GET /users` - ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§å–å¾—
- `GET /users/{userId}` - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾—
